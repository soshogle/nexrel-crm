<?php
/** @noinspection ALL */
/**
  * ATUM WooCommerce Inventory Management and Stock Tracking
  * @author      Be Rebel - https://berebel.io
  * @copyright   ©2026 Stock Management Labs™
 */
 namespace Atum\Addons; defined('ABSPATH') || die; use Atum\Components\AtumAdminNotices; use Atum\Components\AtumAdminModal; use Atum\Inc\Helpers; final class AddonsLoader { private $iqwSx = array('action_logs' => '1.1.5', 'export_pro' => '1.3.4', 'multi_inventory' => '1.5.0', 'product_levels' => '1.5.0', 'purchase_orders' => '1.3.0', 'stock_takes' => '0.0.1', 'pick_pack' => '0.0.1', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.0.1'); private $s2gNM = array('action_logs' => '1.3.8', 'export_pro' => '1.6.5', 'multi_inventory' => '1.9.12.1', 'product_levels' => '1.9.15', 'purchase_orders' => '1.2.5', 'stock_takes' => '1.0.7', 'pick_pack' => '1.0.9', 'barcodes_pro' => '0.0.1', 'units_of_measure' => '0.0.1', 'cost_price' => '0.2.0'); private static $gU73T = []; private static $Y3P2m = []; private $q4sJx; public function __construct() { goto HZEX1; u2gP_: if (empty($fZkW8)) { goto RA7Mp; } goto H5QlZ; QD2SN: RA7Mp: goto ajQqS; HZEX1: $this->q4sJx = defined('ATUM_DEBUG') && TRUE === ATUM_DEBUG; goto X7Kep; HJ4Mj: pLMsV: goto QD2SN; ajQqS: add_action('after_setup_theme', array($this, 'load_addons'), 99); goto ysujB; ysujB: $this->check_addons(); goto ShDcJ; H5QlZ: foreach ($fZkW8 as $m6TT2 => $T4qLA) { goto MfjJz; S7UVd: ulN2H: goto O2TjT; MfjJz: if (!(!array_key_exists($m6TT2, $this->s2gNM) && version_compare($T4qLA, '0.0', '>'))) { goto Oy0ST; } goto bAzY8; jcniN: Oy0ST: goto S7UVd; bAzY8: $this->s2gNM[$m6TT2] = $T4qLA; goto jcniN; O2TjT: } goto HJ4Mj; X7Kep: $fZkW8 = (array) apply_filters('atum/addons/loader/extra_addons', []); goto u2gP_; ShDcJ: } public function load_addons() { goto IAmVT; LaJPd: z1gWQ: goto fgMfe; rSjae: QQzEQ: goto e_e92; kYT3E: $yompQ->add_modal('trial-expired', array('icon' => 'warning', 'title' => _n('ATUM trial license expired!', 'ATUM trial licenses expired!', count($Ef73c), ATUM_TEXT_DOMAIN), 'showCancelButton' => FALSE, 'showConfirmButton' => FALSE, 'customClass' => ['container' => 'atum-trial-modal'], 'footer' => sprintf(__('Why are these add-ons expired and blocked? %1$sREAD INFO%2$s', ATUM_TEXT_DOMAIN), '&nbsp;<a href="https://stockmanagementlabs.crunch.help/en/atum-core/atum-trials" target="_blank">', '</a>')), Helpers::load_view_to_string('add-ons/expired-trials-modal', ['expired_trials' => $Ef73c])); goto LaJPd; IAmVT: $gZ3Tv = Addons::get_installed_addons(); goto BjH5K; CdQD6: $uhCzu = Addons::get_keys(); goto XxDQx; NTr_Y: $yompQ = AtumAdminModal::get_instance([ATUM_SHORT_NAME . '-addons']); goto iwtc7; fgMfe: if (!(count(self::$Y3P2m) > 0)) { goto L916R; } goto zRTgz; wg23b: add_action('admin_enqueue_scripts', function () { goto zVo6l; zVo6l: Helpers::register_swal_scripts(); goto LUQCC; LUQCC: wp_register_script('atum-trials-modal', ATUM_URL . 'assets/js/build/atum-trials-modal.js', ['jquery', 'sweetalert2'], ATUM_VERSION, TRUE); goto FtzKK; FtzKK: wp_localize_script('atum-trials-modal', 'atumTrialsModal', array('cancel' => __('Cancel', ATUM_TEXT_DOMAIN), 'extend' => __('Yes, Extend it!', ATUM_TEXT_DOMAIN), 'nonce' => wp_create_nonce(ATUM_PREFIX . 'manage_license'), 'ok' => __('OK', ATUM_TEXT_DOMAIN), 'success' => __('Success!', ATUM_TEXT_DOMAIN), 'trialExtension' => __('Trial extension', ATUM_TEXT_DOMAIN), 'trialWillExtend' => __('You are going to extend this trial for 7 days more', ATUM_TEXT_DOMAIN))); goto w2iYG; w2iYG: }, 1); goto NTr_Y; UAOZT: SrFYo: goto wqp2A; zRTgz: Addons::set_installed_addons($gZ3Tv); goto IncyU; lfyiw: $Ef73c = []; goto CdQD6; uMAN2: foreach ($gZ3Tv as $nPRsb => $E0dXN) { goto vllKZ; qm6O9: if (!(empty($uhCzu[$tXnpb]['expires']) || strtotime($uhCzu[$tXnpb]['expires']) <= time())) { goto xvl5q; } goto q3Sqb; vllKZ: $sx04J = str_contains($nPRsb, '_trial') || str_contains($E0dXN['basename'], 'trial'); goto qgweZ; RtVMV: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto JdJmo; kIqh5: goto LG9zT; goto nERIm; C2nrs: $ik3NN = sprintf(__('The ATUM %1$s add-on requires at least version %2$s to work with the current ATUM version. Please, update it.', ATUM_TEXT_DOMAIN), $E0dXN['name'], $this->s2gNM[$PQa7f]); goto guDRb; SqCz7: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto UFrc3; PDGsz: $Ef73c[$nPRsb]['extended'] = $uhCzu[$tXnpb]['extended'] ?? FALSE; goto ug6Dm; rW63j: self::$Y3P2m[] = $nPRsb; goto MoVSk; hNsch: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto ymUJ8; pB43x: $LNp0J = add_query_arg($c_YMF, Addons::ADDONS_STORE_URL . 'my-upgrades/'); goto r5UQM; JhdCc: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto gHioF; UFrc3: self::$Y3P2m[] = $nPRsb; goto fSp4B; U59LW: $this->show_notices($E0dXN, $ik3NN); goto RtVMV; Pl1K6: LG9zT: goto BaAYC; V0RuY: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto wD6A_; yAfHx: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto j9FVL; WxqF6: iMzyB: goto RP4Qv; KGEnr: $this->show_notices($E0dXN, $ik3NN); goto JhdCc; pj4gV: Addons::delete_status_transient($tXnpb); goto fe1x1; glgkp: $ik3NN = sprintf(__('The ATUM %s add-on could not be loaded because is not a known add-on.', ATUM_TEXT_DOMAIN), $E0dXN['name']); goto U59LW; gHioF: self::$Y3P2m[] = $nPRsb; goto pj4gV; l1AR7: $ik3NN = sprintf(__('Your ATUM %1$s has expired and it has been disabled.', ATUM_TEXT_DOMAIN), $E0dXN['name']); goto L551T; SlVVX: lp4eo: goto l1AR7; TzoZ2: if (!(!$wSeVt && !empty($this->iqwSx[$nPRsb]) && version_compare($this->iqwSx[$nPRsb], $E0dXN['version'], '<'))) { goto rdfp_; } goto V0RuY; Yb2wB: LTVPy: goto MAgZm; EQ0D2: EQyUo: goto VsOfU; qHDDY: Rm49c: goto qm6O9; unn_I: Addons::delete_status_transient($tXnpb); goto P2h6G; MoVSk: goto LG9zT; goto EQ0D2; cXiSY: if (!(empty($uhCzu) || empty($uhCzu[$tXnpb]) || empty($uhCzu[$tXnpb]['key']))) { goto LTVPy; } goto eEfXJ; wD6A_: array_pop(self::$gU73T); goto XHJMG; rZq0s: if (!version_compare($this->s2gNM[$PQa7f], $E0dXN['version'], '>')) { goto EQyUo; } goto C2nrs; BY8Xz: $ik3NN = sprintf(__('The ATUM %s could not be loaded because the full version is installed. Please, uninstall this trial and enable the full version.', ATUM_TEXT_DOMAIN), $E0dXN['name']); goto KGEnr; fSp4B: Addons::delete_status_transient($tXnpb); goto Tv3tQ; Tv3tQ: goto LG9zT; goto qHDDY; dzC2Z: $gZ3Tv[$nPRsb]['bootstrap'] = NULL; goto rW63j; XHJMG: self::$Y3P2m[] = $nPRsb; goto BAYrc; q3Sqb: $Ef73c[$nPRsb] = $E0dXN; goto uMXnv; L551T: dircS: goto meGIc; Okign: $tXnpb = strtolower($QppUj[$PQa7f]['name'] ?? ''); goto rgmaU; acHm8: if (!(isset($gZ3Tv[$PQa7f]) || !$this->q4sJx && !empty($QppUj[$PQa7f]['basename']) && file_exists(WP_PLUGIN_DIR . '/' . $QppUj[$PQa7f]['basename']))) { goto SIKmu; } goto BY8Xz; fe1x1: goto LG9zT; goto ua51A; SEeUM: $ik3NN = sprintf(__('Your ATUM %1$s has expired on %2$s, and it has been disabled.', ATUM_TEXT_DOMAIN), $E0dXN['name'], date_i18n(get_option('date_format'), strtotime($uhCzu[$tXnpb]['expires']))); goto NATQF; guDRb: $this->show_notices($E0dXN, $ik3NN); goto dzC2Z; JdJmo: self::$Y3P2m[] = $nPRsb; goto kIqh5; meGIc: $this->show_notices($E0dXN, $ik3NN . ' ' . sprintf(__('Click %1$shere%2$s to purchase the full version.', ATUM_TEXT_DOMAIN), '<a href="' . $E0dXN['addon_url'] . '" target="_blank">', '</a>')); goto yAfHx; ymUJ8: self::$Y3P2m[] = $nPRsb; goto unn_I; nERIm: uNugl: goto rZq0s; r5UQM: $ik3NN = sprintf('trial_used' === $uhCzu[$tXnpb]['status'] ? __('The ATUM %1$s could not be loaded because it has already been used on another site. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN) : __('The ATUM %1$s could not be loaded because its license is invalid. Please, %2$supgrade to the full version%3$s.', ATUM_TEXT_DOMAIN), $E0dXN['name'], '<a href="' . $LNp0J . '" target="_blank">', '</a>'); goto WZ2n9; WZ2n9: $this->show_notices($E0dXN, $ik3NN); goto SqCz7; ua51A: SIKmu: goto cXiSY; l7bwN: $this->show_notices($E0dXN, $ik3NN); goto hNsch; qgweZ: $PQa7f = $sx04J ? str_replace('_trial', '', $nPRsb) : $nPRsb; goto Okign; dbvX4: C3eP1: goto Pl1K6; w1XhF: $Ef73c[$nPRsb]['key'] = $uhCzu[$tXnpb]['key']; goto PDGsz; j9FVL: self::$Y3P2m[] = $nPRsb; goto oFacc; uMXnv: $Ef73c[$nPRsb]['expires'] = $uhCzu[$tXnpb]['expires'] ?? 'now'; goto w1XhF; BAYrc: rdfp_: goto dbvX4; MAgZm: if (!in_array($uhCzu[$tXnpb]['status'], ['trial_used', 'invalid', 'disabled', 'missing', 'key_mismatch'])) { goto Rm49c; } goto MNUe4; VBZe4: self::$gU73T[] = $nPRsb; goto qllb5; eEfXJ: $ik3NN = sprintf(__('The ATUM %1$s could not be loaded because its license is missing. Please, activate your trial from the %2$sadd-ons%3$s page.', ATUM_TEXT_DOMAIN), $E0dXN['name'], '<a href="' . add_query_arg('page', 'atum-addons', admin_url('admin.php')) . '">', '</a>'); goto l7bwN; NATQF: goto dircS; goto SlVVX; P2h6G: goto LG9zT; goto Yb2wB; rgmaU: if (isset($this->s2gNM[$PQa7f])) { goto uNugl; } goto glgkp; qllb5: $wSeVt = call_user_func($E0dXN['bootstrap']); goto TzoZ2; sgYBr: xvl5q: goto WxqF6; VsOfU: if (!$sx04J) { goto iMzyB; } goto acHm8; oFacc: goto LG9zT; goto sgYBr; MNUe4: $c_YMF = array('key' => $uhCzu[$tXnpb]['key'], 'url' => home_url()); goto pB43x; RP4Qv: if (!(!empty($E0dXN['bootstrap']) && is_callable($E0dXN['bootstrap']))) { goto C3eP1; } goto VBZe4; ug6Dm: if ('now' === $Ef73c[$nPRsb]['expires']) { goto lp4eo; } goto SEeUM; BaAYC: } goto UAOZT; IncyU: L916R: goto rSjae; wqp2A: if (empty($Ef73c)) { goto z1gWQ; } goto wg23b; XxDQx: $QppUj = Addons::get_addons_paths(); goto uMAN2; BjH5K: if (empty($gZ3Tv)) { goto QQzEQ; } goto lfyiw; iwtc7: $yompQ->set_js_dependencies(['atum-trials-modal']); goto kYT3E; e_e92: } public function check_addons() { add_filter('atum/queues/recurring_hooks', function ($qgjd4) { $qgjd4['atum/check_addons'] = array('time' => 'now', 'interval' => DAY_IN_SECONDS); return $qgjd4; }); add_action('atum/check_addons', function () { goto rCoTM; DHeF7: return; goto BA6D1; iJvqA: foreach ($nXq2D as $tv7C3) { goto JDA0t; mWUlL: $MWEaN['extended'] = TRUE; goto k7EZe; AAinb: if (!($KF3EB['status'] !== $ax9hn->leh56)) { goto VkXLy; } goto J9cYH; AOewb: cZHF5: goto qo6m6; TDqtp: Izbpw: goto NowA2; ymRJH: ueA8p: goto idURS; VNBAd: rNLs6: goto LkKIS; BTYoX: if (!(empty($KF3EB['expires']) || $KF3EB['expires'] !== $ax9hn->kag8Z)) { goto Izbpw; } goto pdvsI; xtM74: if (!str_contains($i1Kce, 'trial')) { goto FFXg4; } goto W60ab; k7EZe: RVw86: goto wstdr; LoweR: $D468f = Addons::check_license($i1Kce, $KF3EB['key']); goto sWTBx; mmWDO: $fsLHu = TRUE; goto XG4na; J9cYH: $MWEaN['status'] = $ax9hn->leh56; goto qTl3N; kwtUT: iP_yF: goto AOewb; wstdr: if (empty(array_diff_assoc($KF3EB, $MWEaN))) { goto iP_yF; } goto GmgiQ; pdvsI: $MWEaN['expires'] = $ax9hn->kag8Z ?? date_i18n('Y-m-d H:i:s'); goto TDqtp; M46a6: $MWEaN = $KF3EB; goto n4nOI; EIMG0: $ax9hn = json_decode(wp_remote_retrieve_body($D468f)); goto M46a6; qo6m6: EE0Q4: goto WEJ0l; LkKIS: if (!(empty($KF3EB['extended']) && (!isset($ax9hn->o7IFU) || TRUE !== $ax9hn->o7IFU))) { goto RVw86; } goto mWUlL; WEJ0l: Qxg1y: goto Pmtlj; XG4na: $KF3EB = $rW_k8[$tXnpb]; goto LoweR; qTl3N: VkXLy: goto BTYoX; Pmtlj: FFXg4: goto ymRJH; HXDg_: if (!(is_array($rW_k8) && array_key_exists($tXnpb, $rW_k8))) { goto Qxg1y; } goto mmWDO; At6Er: $MWEaN['trial'] = TRUE; goto VNBAd; sWTBx: if (!(!is_wp_error($D468f) && isset($KF3EB['status']) && 'valid' === $KF3EB['status'])) { goto EE0Q4; } goto EIMG0; W60ab: $tXnpb = trim(str_replace('trial', '', $i1Kce)); goto HXDg_; n4nOI: if (!($ax9hn && !empty($ax9hn->leh56))) { goto cZHF5; } goto AAinb; GmgiQ: Addons::update_key($i1Kce, $MWEaN); goto kwtUT; JDA0t: $i1Kce = strtolower($tv7C3['name']); goto xtM74; NowA2: if (!(empty($KF3EB['trial']) && isset($ax9hn->LPKG5) && TRUE === $ax9hn->LPKG5)) { goto rNLs6; } goto At6Er; idURS: } goto rXDDY; rCoTM: $rW_k8 = Addons::get_keys(); goto wtH71; ZaU8h: if (!(FALSE !== Addons::get_last_api_access('check_addons'))) { goto wqYLO; } goto DHeF7; l2qxt: if (!$fsLHu) { goto r0GBM; } goto hnFoC; T4u8F: $fsLHu = FALSE; goto iJvqA; QGBHm: r0GBM: goto gmXKn; rXDDY: v1xgg: goto l2qxt; wtH71: $nXq2D = Addons::get_installed_addons(); goto ZaU8h; hnFoC: Addons::set_last_api_access('check_addons'); goto QGBHm; BA6D1: wqYLO: goto T4u8F; gmXKn: }); } private function show_notices($E0dXN, $ik3NN) { AtumAdminNotices::add_notice($ik3NN, strtolower($E0dXN['name']), 'error', FALSE, TRUE); add_action('after_plugin_row_' . $E0dXN['basename'], function ($nQpC1, $EOLEE) use($ik3NN) { goto vGcvd; vGcvd: ?>
			<tr class="plugin-update-tr active">
				<td colspan="4" class="plugin-update colspanchange">
					<div class="notice inline notice-error notice-alt">
						<p><?php  goto PmDNW; moO9l: echo esc_attr($nQpC1); goto ap452; uNA_z: ?></p>
					</div>
				</td>
			</tr>
			<style>tr[data-plugin="<?php  goto moO9l; PmDNW: echo $ik3NN; goto uNA_z; yi_qA: ?>"] td { box-shadow: none !important; }</style>
			<?php  goto me53_; ap452: ?>"] th, tr[data-plugin="<?php  goto scWF7; scWF7: echo esc_attr($nQpC1); goto yi_qA; me53_: }, 100, 2); } public static function get_bootstrapped_addons() { return self::$gU73T; } public static function get_non_bootstrapped_addons() { return self::$Y3P2m; } public static function check_addon($m6TT2, $i1Kce, $WNCK0) { goto wb0ML; rZPzc: if (!(stripos($i1Kce, 'Trial') === FALSE)) { goto oBHMY; } goto lTHW3; pb9x4: QgaIE: goto cuH7z; qwGUf: return FALSE; goto FddwC; FddwC: sG0yk: goto rZPzc; lTHW3: return FALSE; goto wqKh2; wb0ML: if (!(stripos($m6TT2, '_trial') === FALSE)) { goto sG0yk; } goto qwGUf; cuH7z: return TRUE; goto aLcU4; iExAK: return FALSE; goto pb9x4; bjQbH: if (!(stripos($WNCK0, '-trial.php') === FALSE)) { goto QgaIE; } goto iExAK; wqKh2: oBHMY: goto bjQbH; aLcU4: } }