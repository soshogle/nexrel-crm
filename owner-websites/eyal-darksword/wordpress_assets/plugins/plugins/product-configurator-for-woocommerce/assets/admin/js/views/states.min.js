var PC=PC||{};PC.views=PC.views||{},(i=>{PC.views.states=Backbone.View.extend({items:[],template:wp.template("mkl-pc-menu"),initialize:function(t){this.app=t.parent,this.render()},render:function(){return this.$el.append(this.template()),this.app.states.length&&(this.$menu=this.$(".media-menu").html(""),this.create_menu()),this},reset_active:function(){},create_menu:function(){var i=this;i.items=[],this.app.states.orderBy="order",this.app.states.sort(),this.app.states.each(function(t,e){var s="";switch(t.get("type")){case"part":s=new PC.views.menu_item({model:t,collection:i.app.states,app:i.app,main_view:i});break;case"separator":s=new PC.views.separator}i.items[e]=s,i.$menu.append(s.$el)});i.items[0].$el.trigger("click")}}),PC.views.menu_item=Backbone.View.extend({tagName:"a",className:"media-menu-item",initialize:function(t){this.options=t||{},this.options.collection&&(this.collection=this.options.collection),this.render(),this.listenTo(this.model,"change:active",this.activate)},events:{click:"show_this_state"},activate:function(){!0===this.model.get("active")?this.$el.addClass("active"):(this.$el.removeClass("active"),this.state&&this.state.remove())},show_this_state:function(t){t.preventDefault(),!1===this.model.get("active")&&(this.collection.each(function(t){t.set("active",!1)}),this.state&&this.state.remove(),this.state=new PC.views.state({model:this.model,options:this.options}),this.options.main_view.$el.append(this.state.$el),this.options.main_view.$menu.removeClass("visible"))},render:function(){return this.$el.attr("href","#"),this.$el.html(this.model.get("label")),this}}),PC.views.state=Backbone.View.extend({tagName:"div",className:"modal-frame-target",events:{"click .pc-main-save":"save_state","click .pc-main-save-all":"save_all","click .pc-main-cancel":"cancel","click .media-frame-menu-toggle":"show_mobile_menu"},initialize:function(t){if(this.options=t.options||{},State=PC.views[this.model.get("menu_id")])return this.state&&this.state.remove(),this.$el.empty(),this.title_template=wp.template("mkl-pc-frame-title"),this.toolbar_template=wp.template("mkl-pc-toolbar"),this.state=new State({app:this.options.app}),PC.app.state=this.state,this.collectionName=this.state.collectionName,this.col=this.state.col,this.model.set("active",!0),this.render(),this;throw"There is no View called PC.views."+this.model.get("menu_id")},render:function(){var s;return this.$el.append(this.title_template(this.model.attributes)),this.$el.append(this.state.$el),this.$el.append(this.toolbar_template(this.model.attributes)),this.state.$toolbar=this.$toolbar=this.$(".media-frame-toolbar"),this.menu=this.model.get("menu"),this.menu&&1<this.menu.length&&(s=new PC.views.button_group,this.$(".media-toolbar-primary").append(s.render().el),i.each(this.menu,function(t,e){t=new PC.views.button(t);s.$el.append(t.render().el)})),this.state.$save_button=this.$save_button=this.$(".pc-main-save"),this.state.$save_all_button=this.$save_all_button=this.$(".pc-main-save-all"),this},save_state:function(t){if(1!=PC.app.is_modified[this.collectionName])return!1;this.$save_button.addClass("disabled"),this.$save_all_button.addClass("disabled"),this.$toolbar.addClass("saving"),PC.app.save(this.collectionName,this.col,{success:i.bind(this.state_saved,this),error:i.bind(this.error_saving,this)})},state_saved:function(t){this.$save_button.removeClass("disabled"),this.$save_all_button.removeClass("disabled"),this.$toolbar.removeClass("saving"),this.$el.removeClass("saving"),this.$toolbar.addClass("saved"),this.$el.addClass("saved");var e=this;i.delay(function(){e.$toolbar.removeClass("saved"),e.$el.removeClass("saved")},2500),t||(PC.app.is_modified[this.collectionName]=!1)},error_saving:function(t,e){this.$save_button.removeClass("disabled"),this.$save_all_button.removeClass("disabled"),this.$toolbar.removeClass("saving"),alert(t)},save_all:function(){PC.app.save_all(this)},cancel:function(){PC.app.get_admin().close()},show_mobile_menu:function(t){console.log(this,this.options),this.options.main_view.$menu.toggleClass("visible")}}),PC.views.separator=Backbone.View.extend({tagName:"div",className:"separator",initialize:function(){this.render()},render:function(){return this}}),PC.views.button_group=Backbone.View.extend({className:"button-group media-button-group",render:function(){return this}}),PC.views.button=Backbone.View.extend({tagName:"button",className:"button media-button button-large",initialize:function(t){this.options=i.defaults(t,{text:" - ",class:""}),this.render()},render:function(){return this.$el.attr("type","button"),this.$el.html(this.options.text),this.$el.addClass(this.options.class),this}})})(PC._us||window._);