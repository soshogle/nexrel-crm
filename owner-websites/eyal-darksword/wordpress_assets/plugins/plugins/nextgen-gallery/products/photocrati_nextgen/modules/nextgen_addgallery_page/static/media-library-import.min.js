(l=>{var r={ml_data:null,import_ids:[],selectors:{ml_btn_import:l("#ngg-importML-selected-image-import"),ml_btn_select:l("#ngg-importML-select-opener"),gallery_select:l("#ngg-importML-gallery-id"),gallery_name:l("#ngg-importML-gallery-name")},initialize:function(){this.methods.initialize(),this.methods.set_events()},methods:{initialize:function(){r.ml_dialog=top.wp.media.frames.ngg_importml=top.wp.media({multiple:!0,title:ngg_importml_i18n.title,button:{text:ngg_importml_i18n.button_text}})},urlencode:function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},import:{import_count:0,params:{action:"import_media_library"},start:function(){r.selectors.ml_btn_import.attr("disabled",!0),r.selectors.ml_btn_select.attr("disabled",!0),r.methods.import.params.gallery_id=r.methods.urlencode(r.selectors.gallery_select.val()),r.methods.import.params.gallery_name=r.methods.urlencode(r.selectors.gallery_name.val()),r.progress_bar=l.nggProgressBar({title:ngg_importml_i18n.progress_title,infinite:!0,starting_value:ngg_importml_i18n.in_progress}),l(r).trigger("send_ajax")},done:function(){r.progress_bar.close(100),r.selectors.ml_btn_import.attr("disabled",!1),r.selectors.ml_btn_select.attr("disabled",!1);var e=ngg_importml_i18n.imported_multiple,e=(e=(e=1==r.methods.import.import_count?ngg_importml_i18n.imported_singular:e).replace("{gid}",r.methods.import.params.gallery_id)).replace("{count}",r.methods.import.import_count);delete r.methods.import.params.gallery_id,delete r.methods.import.params.gallery_name,l.gritter.add({title:ngg_importml_i18n.gritter_title,text:e,sticky:!0}),r.methods.import.import_count=0,r.ml_dialog.trigger("reset"),r.import_ids=[],r.selectors.ml_btn_import.fadeOut()},send_ajax:function(){var e=r.methods.import.params;e.nonce=ngg_importml_i18n.nonce,e.attachment_ids=[r.import_ids.pop()],l.post(photocrati_ajax.url,e,function(e){var t;void 0===e.error?(r.methods.import.import_count++,0==r.selectors.gallery_select.find('option[value="'+e.gallery_id+'"]').length&&(r.methods.import.params.gallery_id=e.gallery_id,t=l("<option/>").attr("value",e.gallery_id).html(e.gallery_name),r.selectors.gallery_select.append(t),r.selectors.gallery_select.val(e.gallery_id),t.prop("selected",!0),r.selectors.gallery_name.val("").fadeOut())):l.gritter.add({title:ngg_importml_i18n.gritter_error,text:e.error,sticky:!0}),0==r.import_ids.length?r.methods.import.done():l(r).trigger("send_ajax")},"json")}},set_events:function(){l(r).on("send_ajax",function(){r.methods.import.send_ajax()}),r.ml_dialog.on("select",function(){r.import_ids=[],r.ml_data=r.ml_dialog.state().get("selection"),r.ml_data.map(function(e){e=e.toJSON(),r.import_ids.push(e.id)});var e=ngg_importml_i18n.import_multiple.replace("%s",r.import_ids.length);1==r.import_ids.length&&(e=ngg_importml_i18n.import_singular),r.selectors.ml_btn_import.html(e),r.selectors.ml_btn_import.fadeIn()}),r.selectors.ml_btn_select.on("click",function(e){e.preventDefault(),r.ml_dialog.open()}),r.selectors.ml_btn_import.on("click",function(e){e.preventDefault(),r.methods.import.start()}),r.selectors.gallery_select.on("change",function(){0==parseInt(this.value)?(r.selectors.gallery_name.fadeIn().trigger("focus"),0==r.selectors.gallery_name.val().length&&(r.selectors.ml_btn_import.fadeOut(),r.selectors.ml_btn_select.fadeOut())):r.selectors.gallery_name.fadeOut(400,function(){r.selectors.gallery_select.trigger("focus"),r.selectors.ml_btn_select.fadeIn(),0<r.import_ids.length&&r.selectors.ml_btn_import.fadeIn()})}),r.selectors.gallery_name.on("keyup",function(){0<r.selectors.gallery_name.val().length?(r.selectors.gallery_name.removeClass("error"),r.selectors.ml_btn_select.fadeIn(),0<r.import_ids.length&&r.selectors.ml_btn_import.fadeIn()):(r.selectors.ml_btn_import.fadeOut(),r.selectors.ml_btn_select.fadeOut())})}}};jQuery(function(){(window.ngg_importml=r).initialize(),window.Frame_Event_Publisher.broadcast()})})(jQuery);