(()=>{let o=(t,e)=>(e||document).querySelector(t),r={requestMade:!1,init:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("click",function(t){var e=t.target.closest("#shipstation-view-auth"),a=t.target.closest(".shipstation-modal-close"),s=t.target.closest(".shipstation-modal-backdrop"),i=t.target.closest(".shipstation-copy-btn"),o=t.target.closest(".shipstation-toggle-visibility"),n=t.target.closest("#shipstation-generate-new-keys");e?r.showModal(t):a||s?r.hideModal(t):i?r.copyToClipboard(t,i):o?r.toggleVisibility(t,o):n&&r.generateNewKeys(t)})},showModal:function(t){t.preventDefault();var t=o("#shipstation-auth-modal");t&&(t.style.display="block",(t=o(".shipstation-modal-close",t))&&t.focus(),r.requestMade||((t=o(".shipstation-loading-overlay"))&&(t.style.display="flex"),r.loadAuthData()))},hideModal:function(t){var t=t.target;(t.classList.contains("shipstation-modal-close")||t.classList.contains("shipstation-modal-backdrop"))&&(t=o("#shipstation-auth-modal"))&&(t.style.display="none")},loadAuthData:function(){var t=new FormData;t.append("action","shipstation_get_auth_data"),t.append("nonce",wc_shipstation_auth_params.nonce),fetch(wc_shipstation_auth_params.ajax_url,{method:"POST",credentials:"same-origin",body:t}).then(function(t){return t.json()}).then(function(t){t&&t.success?r.populateModal(t.data):r.showError(t&&t.data||wc_shipstation_auth_params.error_text)}).catch(function(){r.showError(wc_shipstation_auth_params.error_text)})},populateModal:function(t){var e=o(".shipstation-loading-overlay"),e=(e&&(e.style.display="none"),r.requestMade=!0,o("#shipstation-first-view")),a=o("#shipstation-after-view"),s=(t.consumer_secret?(a&&(a.style.display="none"),e&&(e.style.display="block"),s=o("#shipstation-consumer-key"),i=o("#shipstation-consumer-secret"),s&&(s.value=t.consumer_key||""),i&&(i.value=t.consumer_secret||"")):(e&&(e.style.display="none"),a&&(a.style.display="block")),o("#shipstation-auth-key")),i=o("#shipstation-site-url");s&&(s.value=t.auth_key||""),i&&(i.value=t.site_url||"")},showError:function(t){var e,a,s,i=o(".shipstation-loading-overlay"),i=(i&&(i.style.display="none"),o("#shipstation-auth-modal"));i&&(i=o(".shipstation-modal-body",i))&&!o(".shipstation-error-overlay",i)&&((e=document.createElement("div")).className="shipstation-error-overlay",(a=document.createElement("div")).className="shipstation-error notice notice-error",(s=document.createElement("p")).textContent=t,a.appendChild(s),e.appendChild(a),i.insertBefore(e,i.firstChild))},copyToClipboard:function(t,e){t.preventDefault();var t=e&&e.dataset?e.dataset.target:"";t&&(t=document.getElementById(t))&&navigator.clipboard.writeText(t.value).then(function(){r.showCopyFeedback(e)})},showCopyFeedback:function(t){let e=o(".dashicons",t),a=e?e.getAttribute("class"):"",s=t.getAttribute("title")||"";e&&e.setAttribute("class","dashicons dashicons-yes-alt"),t.setAttribute("title",wc_shipstation_auth_params.copy_text),t.classList.add("copied"),window.setTimeout(function(){e&&a&&e.setAttribute("class",a),t.setAttribute("title",s),t.classList.remove("copied")},2e3)},toggleVisibility:function(t,e){t.preventDefault();var a,t=e&&e.dataset?e.dataset.target:"";t&&(t=document.getElementById(t),a=o(".dashicons",e),t)&&("password"===t.getAttribute("type")?(t.setAttribute("type","text"),a&&(a.classList.remove("dashicons-visibility"),a.classList.add("dashicons-hidden")),e.setAttribute("title",wc_shipstation_auth_params.hide_text)):(t.setAttribute("type","password"),a&&(a.classList.remove("dashicons-hidden"),a.classList.add("dashicons-visibility")),e.setAttribute("title",wc_shipstation_auth_params.show_text)))},generateNewKeys:function(t){window.confirm(wc_shipstation_auth_params.confirm_text)&&(t.preventDefault(),(t=o(".shipstation-loading-overlay"))&&(t.style.display="flex"),(t=new FormData).append("action","shipstation_generate_new_keys"),t.append("nonce",wc_shipstation_auth_params.nonce),fetch(wc_shipstation_auth_params.ajax_url,{method:"POST",credentials:"same-origin",body:t}).then(function(t){return t.json()}).then(function(t){t&&t.success?r.populateModal(t.data):r.showError(t&&t.data||wc_shipstation_auth_params.error_text)}).catch(function(){r.showError(wc_shipstation_auth_params.error_text)}))}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){r.init()}):r.init()})();
